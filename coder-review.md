<noindex>

### Замечания
 - Если делаем по принципу один эндпоинт - один контроллер, то вместо метода `get` наверное должен быть метод `__invoke()`. Если такой архитектуры не заложено, 
   то нужно объединить `AddToCartController` и `GetCartController` в один `CartController`
 - Желательно добавить базовый контроллер в котором реализовать метод `asJson`. 
   Заголовок `Content-Type` по идее должен и так задаваться в [JsonResponse.php](src/Controller/JsonResponse.php).
   Контроллеры наследовать от базового.
 - Добавить интерфейс для [CartManager.php](src/Repository/CartManager.php), в контроллерах указывать этот интерфейс, вместо конкретного класса(настроить DI для этого)
 - Убрать метод `setLogger` из `CartManager`. `LoggerInterface` инжектить через конструктор, сделать его приватным, а не публичным.
   Добавить возвращаемые типы для методов. Логирование ошибок сделать более информативным
 - `CartManager` не должен наследоваться от класса-коннектора. Вообще, лучше сделать чтобы `CartManager` не был жёстко привязан к redis.
   Надо реализовать подход в котором можно было бы легко переключиться с redis на какое-то другое хранилище
 - `\Raketa\BackendTestTask\Infrastructure\Connector` - конструктор не может что-либо возвращать. Не указаны типы возвращаемых данных у методов
 - Метод `Connector::get()` принимает класс `Cart` как ключ, это неверно, поправить. И возвращать null если корзина не найдена в хранилище.
   К ключу при сохранении/получении из redis добавить префикс `cart:`. Время жизни корзины вынести в константу
 - `\Raketa\BackendTestTask\Domain\Cart::getItems()` - добавить phpdoc. 
 - `\Raketa\BackendTestTask\Domain\Cart::addItem()` - Добавить проверку на дублирование товара, в случае дубляжа увеличить `quantity`. 
    Для этого у класса `CartItem` убрать `readonly`, добавить его к свойствам(кроме `quantity`). И сделать свойства приватными
 - [AddToCartController.php](src/Controller/AddToCartController.php) - "толстый" контроллер. Вынести бизнес логику в какой-то сервисный слой,
   либо можно использовать паттерн "Команда". Плюс не реализовано сохранение корзины после добавления в неё товара.
 - [GetCartController.php](src/Controller/GetCartController.php) - предлагаю не возвращать 404 если корзина не найдена, а отдавать пустую корзину.
   Но это обсуждаемо, может и лучше отдавать 404, но тогда нужно будет создавать корзину при добавлении товара(если её нет)
 - [schema.init.sql](migrations/schema.init.sql)
    - `id` лучше сделать `unsigned`
    - `uuid` ограничить 36 символами, т.к. мы используем uuid v4
    - `name` можно сделать `varchar(255)`, должно хватить
    - `price` лучше хранить в `decimal`
    - докинуть индексы на `uuid` и `category`
 - Во вьюшках лучше убрать работу с репозиториями
 - `Entity\Product` перенести в доменный слой
 - [ProductRepository.php](src/Repository/ProductRepository.php):
    - в запросах использовать bindValues
    - добавить свой exception если продукт не найден
    - в методе `make` явно приводить к нужному типу данные из БД. Метод сделать приватным
    - в конструкторе заюзать [Constructor property promotion](https://www.php.net/releases/8.0/en.php#constructor-property-promotion)
 - Цены лучше хранить строкой, а не float. При подсчётах полной стоимости использовать библиотеку php BCMath
 - При отдаче корзины на каждый товар выполняется отдельный запрос в БД, это нехорошо. Привести к одному запросу.
 - В некоторых файлах нет `declare(strict_types = 1)`

### Примечания
 - Не очень понимаю зачем хранить данные пользователя и paymentMethod в корзине. По ТЗ об этом ничего не сказано.
   Может в конечном варианте это как-то обосновано, но я пока решил убрать эти данные из корзины. 
   В базовый контроллер добавил метод-заглушку который как-будто возвращает авторизованного юзера.
 - Вообще может следовало бы хранить в корзине только товары. Хранить в redis можно было бы используя хэш-таблицу(`hmset`/`hmget`), а не как key-value.
   Будет полезно если корзины большие
 - По хорошему ещё сделать бы чтобы [ConnectorInterface.php](src/Infrastructure/ConnectorInterface.php) не был привязан к [Cart.php](src/Domain/Cart.php)
   Но пока будем считать это микросервисом который работает только с корзиной)
 - Для [ProductRepository.php](src/Repository/ProductRepository.php) тоже можно создать интерфейс и в контроллерах тянуть его через DI

</noindex>